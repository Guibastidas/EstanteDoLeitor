<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estante do Leitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header" id="main-header">
            <div class="container">
                <!-- Primeira linha: Logo e A√ß√µes -->
                <div class="header-top">
                    <div class="header-left">
                        <button class="btn-back" id="btn-back" onclick="goToHome()" style="display: none;">
                           ‚¨ÖÔ∏è Voltar
                        </button>
                        <h1 class="logo" onclick="goToHome()" style="cursor: pointer;">Estante do Leitor</h1>
                    </div>
                    
                    <div class="header-right" id="header-actions">
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="Buscar HQs..." onkeyup="handleSearch()">
                            <button class="search-clear" id="search-clear" onclick="clearSearch()" style="display: none;">&times;</button>
                            <span class="search-icon">üîç</span>
                        </div>
                        <button class="btn-sync" onclick="recalcularTodasHQs(event)" title="Recalcular edi√ß√µes de TODAS as HQs baseado na planilha">
                            üîÑ Recalcular Tudo
                        </button>
                        <button class="btn-primary" onclick="openModal()">
                            <span>+</span> Nova HQ
                        </button>
                    </div>
                </div>
                
                <!-- Segunda linha: Filtros + Stats compactos -->
                <div class="header-filters" id="filters-section">
                    <div class="filter-tabs-compact">
                        <button class="filter-tab-compact active" data-filter="all" onclick="filterSeries('all', this)">
                            üìö Todas
                        </button>
                        <button class="filter-tab-compact" data-filter="para_ler" onclick="filterSeries('para_ler', this)">
                            üìñ Para Ler
                        </button>
                        <button class="filter-tab-compact" data-filter="lendo" onclick="filterSeries('lendo', this)">
                            üìó Lendo
                        </button>
                        <button class="filter-tab-compact" data-filter="concluida" onclick="filterSeries('concluida', this)">
                            ‚úÖ Conclu√≠das
                        </button>
                        <button class="filter-tab-compact" data-filter="saga" onclick="filterSeries('saga', this)">
                            üé≠ Sagas
                        </button>
                    </div>
                    
                    <!-- Stats inline ao lado dos filtros -->
                    <div class="header-stats-inline">
                        <div class="header-stat">
                            <span class="header-stat-value" id="stat-total">0</span>
                            <span class="header-stat-label">Total</span>
                        </div>
                        <div class="header-stat">
                            <span class="header-stat-value" id="stat-para-ler">0</span>
                            <span class="header-stat-label">Para Ler</span>
                        </div>
                        <div class="header-stat">
                            <span class="header-stat-value" id="stat-lendo">0</span>
                            <span class="header-stat-label">Lendo</span>
                        </div>
                        <div class="header-stat">
                            <span class="header-stat-value" id="stat-concluidas">0</span>
                            <span class="header-stat-label">Conclu√≠das</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <div class="container">
                <!-- Home View -->
                <div id="home-view">
                    <div class="comics-grid" id="series-grid"></div>
                    
                    <!-- Pagina√ß√£o -->
                    <div class="pagination" id="pagination-controls" style="display: none;">
                        <div class="pagination-info" id="pagination-info">
                            Mostrando 1-12 de 100
                        </div>
                        <div class="pagination-buttons">
                            <button class="btn-pagination" id="btn-first-page" onclick="goToFirstPage()" title="Primeira p√°gina">
                                ‚èÆÔ∏è
                            </button>
                            <button class="btn-pagination" id="btn-prev-page" onclick="goToPrevPage()" title="P√°gina anterior">
                                ‚óÄÔ∏è
                            </button>
                            <div class="page-numbers" id="page-numbers">
                                <!-- N√∫meros de p√°gina ser√£o inseridos aqui -->
                            </div>
                            <button class="btn-pagination" id="btn-next-page" onclick="goToNextPage()" title="Pr√≥xima p√°gina">
                                ‚ñ∂Ô∏è
                            </button>
                            <button class="btn-pagination" id="btn-last-page" onclick="goToLastPage()" title="√öltima p√°gina">
                                ‚è≠Ô∏è
                            </button>
                        </div>
                    </div>
                    
                    <div class="empty-state" id="empty-state">
                        <div class="empty-icon">üìö</div>
                        <p>Nenhuma HQ encontrada</p>
                    </div>
                </div>

                <!-- Detail View -->
                <div id="detail-view" style="display: none;">
                    <!-- Layout: Capa + Detalhes (com edi√ß√µes dentro) -->
                    <div class="detail-simple-layout">
                        <!-- CAPA -->
                        <div class="detail-cover-column">
                            <img id="detail-cover" src="" alt="" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="detail-cover-placeholder" style="display:none;">üìñ</div>
                        </div>
                        
                        <!-- DETALHES + EDI√á√ïES -->
                        <div class="detail-content-column">
                            <!-- Info -->
                            <div class="detail-info-compact">
                                <div class="info-header">
                                    <h2 id="detail-title">T√≠tulo da S√©rie</h2>
                                    
                                    <!-- Stats de saga INLINE com t√≠tulo -->
                                    <div id="saga-division-stats" class="saga-stats-inline" style="display: none;">
                                        <div class="stat-saga-mini stat-saga-main">
                                            <span class="stat-icon">üìñ</span>
                                            <span class="stat-value" id="detail-main-issues">0</span>
                                        </div>
                                        <div class="stat-saga-mini stat-saga-tieins">
                                            <span class="stat-icon">üîó</span>
                                            <span class="stat-value" id="detail-tie-in-issues">0</span>
                                        </div>
                                    </div>
                                    
                                    <div id="detail-type-badge"></div>
                                </div>
                                
                                <div class="info-meta">
                                    <span id="detail-author"></span>
                                    <span id="detail-publisher"></span>
                                </div>
                                
                                <!-- Edi√ß√µes da Saga (s√≥ aparece para sagas) -->
                                <div id="saga-editions-display" class="saga-editions-box" style="display: none;">
                                    <h4>üìú Edi√ß√µes da Saga:</h4>
                                    <div id="saga-editions-list"></div>
                                </div>
                                
                                <div class="info-progress">
                                    <span class="progress-text" id="detail-progress">0/0 edi√ß√µes (0%)</span>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar" id="detail-progress-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div class="info-stats-mini">
                                    <div class="stat-mini-box">
                                        <span class="stat-icon">üìñ</span>
                                        <span class="stat-label">Lendo</span>
                                        <span class="stat-value" id="detail-reading">0</span>
                                    </div>
                                    <div class="stat-mini-box">
                                        <span class="stat-icon">üì•</span>
                                        <span class="stat-label">Baixadas</span>
                                        <span class="stat-value" id="detail-downloaded">0</span>
                                    </div>
                                    <div class="stat-mini-box">
                                        <span class="stat-icon">üìö</span>
                                        <span class="stat-label">Total</span>
                                        <span class="stat-value" id="detail-total">0</span>
                                    </div>
                                    <button class="btn-notes-mini" id="btn-view-notes" onclick="openNotesModal()" style="display: none;" title="Ver notas">
                                        üìù
                                    </button>
                                    <button class="btn-notes-mini" id="btn-undo" onclick="desfazerUltimaAcao()" title="Desfazer √∫ltima a√ß√£o" disabled>
                                        ‚Ü∂
                                    </button>
                                </div>
                                
                                <div class="info-actions">
                                    <button class="btn-action-detail" onclick="aumentarTotalIssues()">üìö +1 Total</button>
                                    <button class="btn-action-detail btn-success" onclick="openAddIssueModal()">‚ûï Baixada</button>
                                    <button class="btn-action-detail btn-secondary" onclick="recalcularEdicoes()">üîÑ Recalc.</button>
                                </div>
                            </div>
                            
                            <!-- Edi√ß√µes (dentro da mesma coluna) -->
                            <div class="detail-issues-inline">
                                <div class="issues-inline-header">
                                    <h3>Edi√ß√µes</h3>
                                    <div class="issues-header-actions">
                                        <button class="btn-sync-inline btn-mark-all" onclick="marcarTodasComoLidas()" title="Marcar todas como lidas">
                                            ‚úÖ Todas Lidas
                                        </button>
                                        <button class="btn-sync-inline btn-mark-all" onclick="marcarTodasComoNaoLidas()" title="Marcar todas como n√£o lidas">
                                            üìñ Todas N√£o Lidas
                                        </button>
                                        <button class="btn-sync-inline btn-mark-all btn-mark-not-downloaded" onclick="marcarTodasComoNaoBaixadas()" title="Marcar todas como n√£o baixadas">
                                            ‚ùå Todas N√£o Baixadas
                                        </button>
                                        <button class="btn-sync-inline" onclick="sincronizarEdicoesAutomaticamente()">
                                            üîÑ Sincronizar
                                        </button>
                                    </div>
                                </div>
                                <div class="issues-grid-inline" id="issues-list"></div>
                                <div class="empty-issues-inline" id="empty-issues" style="display: none;">
                                    <span>üìñ</span>
                                    <p>Nenhuma edi√ß√£o</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Add/Edit S√©rie -->
    <div class="modal" id="series-modal">
        <div class="modal-overlay" onclick="closeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Nova HQ</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form class="modal-body" id="series-form" onsubmit="submitSeriesForm(event)">
                <input type="hidden" id="series-id">
                
                <div class="form-group">
                    <label for="title">T√≠tulo *</label>
                    <input type="text" id="title" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="author">Autor</label>
                        <input type="text" id="author">
                    </div>
                    <div class="form-group">
                        <label for="publisher">Editora</label>
                        <input type="text" id="publisher">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" id="series-total-field">
                        <label for="total_issues">Total de Edi√ß√µes Publicadas</label>
                        <input type="number" id="total_issues" min="0" value="0">
                        <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                            üí° Quantas edi√ß√µes a EDITORA j√° publicou
                        </small>
                    </div>
                </div>
                
                <!-- Campos espec√≠ficos para divis√£o de edi√ß√µes em SAGAS -->
                <div id="saga-issues-division" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="main_issues">üìñ Edi√ß√µes Principais</label>
                            <input type="number" id="main_issues" min="0" value="0" onchange="updateSagaTotal()">
                            <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                                üí° Evento principal (ex: Civil War #1-7)
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="tie_in_issues">üîó Edi√ß√µes Tie-ins</label>
                            <input type="number" id="tie_in_issues" min="0" value="0" onchange="updateSagaTotal()">
                            <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                                üí° Hist√≥rias paralelas (ex: Amazing Spider-Man)
                            </small>
                        </div>
                    </div>
                    <div class="saga-total-display">
                        <strong>Total da Saga:</strong> <span id="saga-total-calculated">0</span> edi√ß√µes
                    </div>
                </div>

                <div class="form-group">
                    <label for="series_type">Tipo *</label>
                    <select id="series_type" onchange="toggleSagaFields()">
                        <option value="em_andamento">S√©rie - Em Andamento</option>
                        <option value="finalizada">S√©rie - Finalizada</option>
                        <option value="lancamento">S√©rie - Lan√ßamento</option>
                        <option value="edicao_especial">Edi√ß√£o Especial</option>
                        <option value="saga">üé≠ Saga / Arco</option>
                    </select>
                </div>
                
                <!-- Campo espec√≠fico para SAGAS -->
                <div class="form-group" id="saga-editions-field" style="display: none;">
                    <label for="saga_editions">Edi√ß√µes da Saga</label>
                    <textarea id="saga_editions" rows="4" placeholder="Liste as edi√ß√µes da saga, uma por linha:
Ex:
Batman #45
Superman #30
Justice League #15"></textarea>
                    <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                        üí° Liste os t√≠tulos e n√∫meros que comp√µem esta saga
                    </small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="is_completed">
                        <span id="completed-label-text">S√©rie finalizada (n√£o sair√£o mais edi√ß√µes)</span>
                    </label>
                </div>

                <div class="form-group">
                    <label for="cover_url">URL da Capa</label>
                    <input type="url" id="cover_url" placeholder="https://...">
                </div>

                <div class="form-group">
                    <label for="notes">Notas</label>
                    <textarea id="notes" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-primary">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Add Edi√ß√£o BAIXADA -->
    <div class="modal" id="issue-modal">
        <div class="modal-overlay" onclick="closeIssueModal()"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Adicionar Edi√ß√£o BAIXADA</h2>
                <button class="modal-close" onclick="closeIssueModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="issue-form" onsubmit="submitIssueForm(event)">
                    <div class="form-group">
                        <label for="issue_number">N√∫mero da Edi√ß√£o *</label>
                        <input type="number" id="issue_number" min="1" required>
                        <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                            üí° Qual edi√ß√£o voc√™ BAIXOU?
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="is_read">
                            <span>Marcar como lida</span>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeIssueModal()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Visualizar Notas -->
    <div class="modal" id="notes-modal">
        <div class="modal-overlay" onclick="closeNotesModal()"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üìù Notas</h2>
                <button class="modal-close" onclick="closeNotesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notes-display" id="notes-display-content"></div>
            </div>
        </div>
    </div>

    <!-- Bot√£o Voltar ao Topo -->
    <button class="scroll-to-top" id="scroll-to-top" onclick="scrollToTop()" title="Voltar ao topo">
        ‚¨ÜÔ∏è
    </button>

    <script src="script.js"></script>
</body>
</html>
