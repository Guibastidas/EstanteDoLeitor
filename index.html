<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estante do Leitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header" id="main-header">
            <div class="container">
                <div class="header-left">
                    <button class="btn-back" id="btn-back" onclick="goToHome()" style="display: none;">
                        ‚Üê Voltar
                    </button>
                    <h1 class="logo" onclick="goToHome()" style="cursor: pointer;">Estante do Leitor</h1>
                </div>
                <div class="header-right" id="header-actions">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Buscar HQs..." onkeyup="handleSearch()">
                        <button class="search-clear" id="search-clear" onclick="clearSearch()" style="display: none;">&times;</button>
                        <span class="search-icon">üîç</span>
                    </div>
                    <button class="btn-primary" onclick="openModal()">
                        <span>+</span> Nova HQ
                    </button>
                </div>
            </div>
        </header>

        <!-- Stats (s√≥ aparece na home) -->
        <section class="stats" id="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total de S√©ries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-para-ler">0</div>
                        <div class="stat-label">Para Ler</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-lendo">0</div>
                        <div class="stat-label">Lendo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-concluidas">0</div>
                        <div class="stat-label">Conclu√≠das</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Filters (s√≥ na home) -->
        <section class="filters" id="filters-section">
            <div class="container">
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all" onclick="filterSeries('all')">
                        Todas
                    </button>
                    <button class="filter-tab" data-filter="para_ler" onclick="filterSeries('para_ler')">
                        Para Ler
                    </button>
                    <button class="filter-tab" data-filter="lendo" onclick="filterSeries('lendo')">
                        Lendo
                    </button>
                    <button class="filter-tab" data-filter="concluida" onclick="filterSeries('concluida')">
                        Conclu√≠das
                    </button>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main">
            <div class="container">
                <!-- Home View - Lista de S√©ries -->
                <div id="home-view">
                    <div class="comics-grid" id="series-grid">
                        <!-- S√©ries ser√£o carregadas aqui -->
                    </div>
                    <div class="empty-state" id="empty-state">
                        <div class="empty-icon">üìö</div>
                        <p>Nenhuma HQ encontrada</p>
                    </div>
                </div>

                <!-- Detail View - Edi√ß√µes de uma S√©rie -->
                <div id="detail-view" style="display: none;">
                    <div class="series-header">
                        <div class="series-cover">
                            <img id="detail-cover" src="" alt="" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="series-cover-placeholder" style="display:none;">üìñ</div>
                        </div>
                        <div class="series-info">
                            <h2 id="detail-title">T√≠tulo da S√©rie</h2>
                            <div class="series-meta">
                                <div id="detail-author"></div>
                                <div id="detail-publisher"></div>
                            </div>
                            <div class="series-progress-info">
                                <div class="progress-item">
                                    <span class="progress-label">Progresso de Leitura</span>
                                    <span class="progress-value" id="detail-progress">0/0 edi√ß√µes (0%)</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar" id="detail-progress-bar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="series-stats-row">
                                <div class="stat-pill">
                                    <span class="pill-label">Lendo:</span>
                                    <span class="pill-value" id="detail-reading">0</span>
                                    <button class="btn-icon-mini" onclick="verificarSincronizacaoLendo()" title="Verificar se o contador est√° correto">
                                        üîç
                                    </button>
                                </div>
                                <div class="stat-pill">
                                    <span class="pill-label">Baixadas:</span>
                                    <span class="pill-value" id="detail-downloaded">0</span>
                                </div>
                                <div class="stat-pill">
                                    <span class="pill-label">Total:</span>
                                    <span class="pill-value" id="detail-total">0</span>
                                </div>
                            </div>
                            
                            <!-- ‚úÖ BOT√ïES CORRIGIDOS -->
                            <div class="series-actions">
                                <button class="btn btn-secondary" onclick="recalcularEdicoes()" title="Recalcula todas as edi√ß√µes baseado nos valores da planilha">
                                    üîÑ Recalcular Edi√ß√µes (da Planilha)
                                </button>
                                <button class="btn btn-sync" onclick="sincronizarEdicoesAutomaticamente()" title="Sincronizar edi√ß√µes automaticamente">
                                    üîÑ Sincronizar Edi√ß√µes
                                </button>
                                <button class="btn-primary" onclick="aumentarTotalIssues()" title="Aumenta o total de edi√ß√µes publicadas pela editora (+1)">
                                    üìö +1 Edi√ß√£o Publicada
                                </button>
                                <button class="btn-primary" onclick="openAddIssueModal()" title="Adicionar uma edi√ß√£o que voc√™ baixou">
                                    ‚ûï Adicionar Edi√ß√£o Baixada
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="issues-section">
                        <h3>Edi√ß√µes</h3>
                        <div class="issues-list" id="issues-list">
                            <!-- Edi√ß√µes ser√£o carregadas aqui -->
                        </div>
                        <div class="empty-state" id="empty-issues" style="display: none;">
                            <div class="empty-icon">üìñ</div>
                            <p>Nenhuma edi√ß√£o cadastrada</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Add/Edit S√©rie -->
    <div class="modal" id="series-modal">
        <div class="modal-overlay" onclick="closeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Nova HQ</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form class="modal-body" id="series-form" onsubmit="submitSeriesForm(event)">
                <input type="hidden" id="series-id">
                
                <div class="form-group">
                    <label for="title">T√≠tulo *</label>
                    <input type="text" id="title" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="author">Autor</label>
                        <input type="text" id="author">
                    </div>
                    <div class="form-group">
                        <label for="publisher">Editora</label>
                        <input type="text" id="publisher">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="total_issues">Total de Edi√ß√µes Publicadas</label>
                        <input type="number" id="total_issues" min="0" value="0" placeholder="Quantas edi√ß√µes foram publicadas">
                        <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                            üí° Os valores "Lendo" e "Baixadas" s√£o calculados automaticamente com base nas edi√ß√µes cadastradas
                        </small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="series_type">Tipo de S√©rie</label>
                    <select id="series_type">
                        <option value="em_andamento">Em Andamento</option>
                        <option value="finalizada">Finalizada</option>
                        <option value="lancamento">Lan√ßamento</option>
                        <option value="edicao_especial">Edi√ß√£o Especial</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="is_completed">
                        <span>S√©rie finalizada (n√£o sair√£o mais edi√ß√µes)</span>
                    </label>
                </div>

                <div class="form-group">
                    <label for="cover_url">URL da Capa</label>
                    <input type="url" id="cover_url" placeholder="https://...">
                </div>

                <div class="form-group">
                    <label for="notes">Notas</label>
                    <textarea id="notes" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-primary">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Add Edi√ß√£o -->
    <div class="modal" id="issue-modal">
        <div class="modal-overlay" onclick="closeIssueModal()"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Adicionar Edi√ß√£o Baixada</h2>
                <button class="modal-close" onclick="closeIssueModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="issue-form" onsubmit="submitIssueForm(event)">
                    <div class="form-group">
                        <label for="issue_number">N√∫mero da Edi√ß√£o *</label>
                        <input type="number" id="issue_number" min="1" required>
                        <small style="color: var(--color-text-secondary); font-size: 0.8rem;">
                            üí° Digite o n√∫mero da edi√ß√£o que voc√™ baixou
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="is_read">
                            <span>Marcar como lida</span>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeIssueModal()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
